jQuery(function(t){"use strict";var e=t(document);t.fn.ctoolkitImagePicker=function(){var i={},n=function(t){var e=[];if(""!=t){var i=t.split(",");for(var n in i){var l=i[n].split("|");e.push(l[0])}}return e};e.on("click",".ctoolkit-image_picker .add_images",function(e){e.preventDefault();var l=t(this),o=l.closest(".ctoolkit-image_picker"),a=o.find('input[type="hidden"]');return i[o.attr("id")]?void i[o.attr("id")].open():(i[o.attr("id")]=wp.media.frames.file_frame=wp.media({title:"Add Images",button:{text:"Add Images"},library:{type:"image"},multiple:o.data("multiple")}),i[o.attr("id")].on("open",function(){var e,l;e=n(a.val()),""!=e&&(l=i[o.attr("id")].state().get("selection"),t(e).each(function(t,e){var i;i=wp.media.attachment(e),i.fetch(),l.add(i?[i]:[])}))}),i[o.attr("id")].on("select",function(){var e,l;e=[],l=i[o.attr("id")].state().get("selection");var r=n(a.val()),s="";l.map(function(i){i=i.toJSON();var n=i.sizes.hasOwnProperty("thumbnail")?i.sizes.thumbnail.url:i.url;(""==r||-1===t.inArray(i.id.toString(),r))&&(s+='<li class="added" data-id="'+i.id+'">\n                                    <div class="inner">\n                                        <img alt="'+i.title+'" src="'+n+'"/>\n                                    </div>\n                                    <a href="#" class="remove"></a>\n                                </li>',n=n.replace(ctoolkit_var.upload_url,""),e.push(i.id+"|"+encodeURIComponent(n)))}),e.length>0&&(o.data("multiple")?(""!=r&&(e=r.concat(e)),o.find(".image_list").append(s)):o.find(".image_list").html(s),a.val(e).change())}),void i[o.attr("id")].open())}),e.on("click",".ctoolkit-image_picker .remove",function(e){e.preventDefault();var i=t(this),n=i.closest(".ctoolkit-image_picker").find('input[type="hidden"]'),l=n.val(),o=i.closest("li").index();""!=l&&(l=l.split(","),delete l[o],l=l.filter(function(t){return t})),n.val(l).trigger("change"),i.closest("li").remove()}),t.fn.sortable&&t(".ctoolkit-image_picker .image_list").sortable({stop:function(e,i){var n=[],l=t(i.item[0]).parent();l.find("li").each(function(){n.push(t(this).attr("data-id"))}),l.closest(".ctoolkit-image_picker").find('input[type="hidden"]').val(n).change()}})},t.fn.ctoolkitLink=function(){e.on("click",".ctoolkit-link .link_button",function(e){e.preventDefault();var i,n,l,o,a,r,s,c,u;i=t(this).closest(".ctoolkit-link"),n=i.find("input.ctoolkit_value"),l=i.find(".url-label"),o=i.find(".title-label"),a=n.data("json"),r=t("#wp-link-submit"),s=t('<input type="button" name="ctoolkit_link-submit" id="ctoolkit_link-submit" class="button-primary" value="Set Link">'),r.hide(),t("#ctoolkit_link-submit").remove(),s.insertBefore(r),c=t('<div class="link-target ctoolkit-link-nofollow"><label><span></span> <input type="checkbox" id="ctoolkit-link-nofollow"> Add nofollow option to link</label></div>'),t("#link-options .ctoolkit-link-nofollow").remove(),c.insertAfter(t("#link-options .link-target")),setTimeout(function(){var e=t("#most-recent-results").css("top");t("#most-recent-results").css("top",parseInt(e)+c.height())},200),u=window.wpLink,u.open("content"),"string"==typeof a.url&&t("#wp-link-url").length?t("#wp-link-url").val(a.url):t("#url-field").val(a.url),"string"==typeof a.url&&t("#wp-link-text").length?t("#wp-link-text").val(a.title):t("#link-title-field").val(a.title),t("#wp-link-target").length?t("#wp-link-target").prop("checked",a.target.length):t("#link-target-checkbox").prop("checked",a.target.length),t("#ctoolkit-link-nofollow").length&&t("#ctoolkit-link-nofollow").prop("checked",a.rel.length),s.unbind("click.ctoolkitLink").bind("click.ctoolkitLink",function(e){e.preventDefault(),e.stopImmediatePropagation();var i,a={};a.url=t("#wp-link-url").length?t("#wp-link-url").val():t("#url-field").val(),a.title=t("#wp-link-text").length?t("#wp-link-text").val():t("#link-title-field").val();var c=t(t("#wp-link-target").length?"#wp-link-target":"#link-target-checkbox");return a.target=c[0].checked?" _blank":"",a.rel=t("#ctoolkit-link-nofollow")[0].checked?"nofollow":"",i=t.map(a,function(t,e){return"string"==typeof t&&0<t.length?e+":"+encodeURIComponent(t):void 0}).join("|"),n.val(i).change(),n.data("json",a),l.html(a.url+a.target),o.html(a.title),u.close("noReset"),window.wpLink.textarea="",r.show(),s.unbind("click.ctoolkitLink"),s.remove(),t("#wp-link-cancel").unbind("click.ctoolkitLink"),c.attr("checked",!1),t("#most-recent-results").css("top",""),t("#ctoolkit-link-nofollow").attr("checked",!1),!1}),t("#wp-link-cancel").unbind("click.ctoolkitLink").bind("click.ctoolkitLink",function(e){return e.preventDefault(),u.close("noReset"),s.unbind("click.ctoolkitLink"),s.remove(),t("#wp-link-cancel").unbind("click.ctoolkitLink"),t("#wp-link-close").unbind("click.ctoolkitCloseLink"),window.wpLink.textarea="",!1}),t("#wp-link-close").unbind("click").bind("click.ctoolkitCloseLink",function(e){return e.preventDefault(),u.close("noReset"),s.unbind("click.ctoolkitLink"),s.remove(),t("#wp-link-cancel").unbind("click.ctoolkitLink"),t("#wp-link-close").unbind("click.ctoolkitCloseLink"),window.wpLink.textarea="",!1})})},t.fn.ctoolkitTypography=function(){var e={},i=!1,n=function(e,i,n){var l={"font-family":i.value},o=e.find(".subsets select"),a=e.find(".variants select"),r=o[0].selectize,s=a[0].selectize;if(i.hasOwnProperty("variants")&&""!=i.variants){var c=i.variants.split(","),u=[],p=ctoolkit_var.variants;for(var d in i.variants){var f=p.hasOwnProperty(c[d])?p[c[d]]:c[d];u.push({text:f,value:c[d]})}if(s.enable(),s.clearOptions(),s.addOption(u),"object"==typeof n&&n.hasOwnProperty("variants")){var k=n.variants.split(",");s.addItems(k)}else s.addItems(c);l.variants=i.variants}else s.clearOptions(),s.disable();if(i.hasOwnProperty("subsets")&&""!=i.subsets){var v=i.subsets.split(","),u=[],h=ctoolkit_var.subsets;for(var d in v){var f=h.hasOwnProperty(v[d])?h[v[d]]:v[d];u.push({text:f,value:v[d]})}if(r.enable(),r.clearOptions(),r.addOption(u),"object"==typeof n&&n.hasOwnProperty("subsets")){var m=n.subsets.split(",");r.addItems(m)}else t.inArray("latin",v)>=0&&(r.addItem("latin"),l.subsets="latin")}else r.clearOptions(),r.disable();"function"==typeof n&&n(l)},l=t(this),o=l.find(".font_family select");l.find(".variants select").selectize({plugins:["remove_button"],create:!1,onChange:function(n){if(!i){var l=t(this)[0].$wrapper.closest(".ctoolkit-typography"),o=l.data("id"),a=e[o],r=l.data("value");if(""!=r&&a.hasOwnProperty("variants")){"object"==typeof n&&null!=n?a.variants=n.join(","):a.variants=n;var s=encodeURIComponent(JSON.stringify(a));e[o]=a,l.find(".ctoolkit_value").val(s).change()}}}}),l.find(".subsets select").selectize({plugins:["remove_button"],create:!1,onChange:function(n){if(!i){var l=t(this)[0].$wrapper.closest(".ctoolkit-typography"),o=l.data("id"),a=e[o],r=l.data("value");if(""!=r&&a.hasOwnProperty("subsets")){"object"==typeof n&&null!=n?a.subsets=n.join(","):a.subsets=n;var s=encodeURIComponent(JSON.stringify(a));e[o]=a,l.find(".ctoolkit_value").val(s).change()}}}}),o.selectize({labelField:"label",valueField:"value",searchField:"label",create:!1,options:ctoolkit_var.fonts,render:{option:function(t,e){return"<div class='option' data-value='"+t.value+"' data-variants='"+t.variants+"' data-subsets='"+t.subsets+"'>"+t.label+" </div>"}},onInitialize:function(){var i=t(this)[0].$wrapper.closest(".ctoolkit-typography"),n=i.data("id");e[n]={};var l=i.data("value");if(""!=l){var o=JSON.parse(decodeURIComponent(l));o.hasOwnProperty("font-family")&&(e[n]=o,t(this)[0].addItem(o["font-family"]))}},onChange:function(l){i=!0;var o=t(this)[0].$wrapper.closest(".ctoolkit-typography"),a=o.data("id"),r=e[a];if(r.hasOwnProperty("font-family")&&r["font-family"]===l)n(o,this.options[l],r);else{var s=this.options.hasOwnProperty(l)?this.options[l]:{};n(o,s,function(t){r["font-family"]=t["font-family"],r.subsets=t.subsets,r.variants=t.variants;var i=encodeURIComponent(JSON.stringify(r));o.find(".ctoolkit_value").val(i).change(),e[a]=r})}i=!1}}),l.find(".subrow .color").length&&l.find(".subrow .color input").wpColorPicker({change:function(e,i){t(e.target).val(i.color.toString()).change()}}),l.on("change",".subrow input, .subrow select",function(i){var n=t(this).data("key"),l=t(this),o=l.closest(".ctoolkit-typography"),a=o.data("id"),r=l.val();e[a][n]=r;var s=encodeURIComponent(JSON.stringify(e[a]));o.find(".ctoolkit_value").val(s).change(),i.preventDefault()})},t.fn.ctoolkitAutocomplete=function(){t(this).selectize({valueField:"value",searchField:"label",labelField:"label",options:[],create:!1,plugins:["remove_button","drag_drop"],render:{option:function(t,e){return'<div class="option" data-value="'+t.value+'">#'+t.value+" - "+e(t.label)+"</div>"}},load:function(e,i){var n=t(this)[0].$wrapper.closest(".ctoolkit-field"),l=n.data("min_length");if(e.length<parseInt(l))return i();var o=n.data("ajax_type"),a=n.data("ajax_value");t.ajax({url:ajaxurl,type:"GET",data:{action:"ctoolkit_autocomplete_"+o,types:a,s:e},error:function(){i()},success:function(t){i(t)}})}})},t.fn.ctoolkitMultitext=function(){var e=t(this),i=e.find(".multitext-item").clone();i.find("input").val("");var n=function(e,i){var n=[],l=t(e.target).closest(".ctoolkit-multitext"),o=l.find("li"),a=l.find(".ctoolkit_value");"undefined"!=typeof i?a.val("").change():(o.each(function(){var e=t(this).find("input").val();""!=e&&n.push(t(this).find("input").val())}),n.length?a.val(encodeURIComponent(JSON.stringify(n))).change():a.val("").change())};e.on("change",".multitext-item input",function(t){n(t)}),e.on("click",".addnew",function(e){var n=t(this),l=n.closest(".ctoolkit-multitext").find("ul");l.append('<li class="multitext-item">'+i.html()+"</li>"),e.preventDefault()}),e.on("click",".remove",function(e){var i=t(this),l=i.closest("ul"),o=i.closest(".multitext-item");l.find(".multitext-item").length>1?(o.remove(),n(e)):(o.find("input").val("").focus(),n(e,"")),e.preventDefault()}),t.fn.sortable&&e.find("ul").sortable({items:".multitext-item",handle:".short",stop:function(t,e){n(t)}})}});